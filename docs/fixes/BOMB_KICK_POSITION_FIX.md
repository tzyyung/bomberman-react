# 炸彈踢動位置修復

## 問題分析

### 用戶需求
炸彈被踢動後立即移動到玩家面前前進1格的位置。

### 原始問題
- 炸彈被踢動後沒有立即移動到正確位置
- 需要明確炸彈移動的目標位置

## 解決方案

### 1. 修改 moveBombToPlayerFront 方法

#### 原始邏輯
```typescript
// 計算玩家面前的位置
let frontX = player.gridX;
let frontY = player.gridY;

switch (player.direction) {
  case Direction.UP:
    frontY = player.gridY - 1;
    break;
  case Direction.DOWN:
    frontY = player.gridY + 1;
    break;
  case Direction.LEFT:
    frontX = player.gridX - 1;
    break;
  case Direction.RIGHT:
    frontX = player.gridX + 1;
    break;
}
```

#### 修復後邏輯
```typescript
// 計算玩家面前前進1格的位置
let targetX = player.gridX;
let targetY = player.gridY;

switch (player.direction) {
  case Direction.UP:
    targetY = player.gridY - 1;
    break;
  case Direction.DOWN:
    targetY = player.gridY + 1;
    break;
  case Direction.LEFT:
    targetX = player.gridX - 1;
    break;
  case Direction.RIGHT:
    targetX = player.gridX + 1;
    break;
}
```

### 2. 位置計算邏輯

#### 目標位置計算
- **玩家位置**：`(player.gridX, player.gridY)`
- **目標位置**：玩家面前前進1格的位置
- **方向計算**：根據玩家面對的方向計算目標位置

#### 方向映射
- **向上**：`targetY = player.gridY - 1`
- **向下**：`targetY = player.gridY + 1`
- **向左**：`targetX = player.gridX - 1`
- **向右**：`targetX = player.gridX + 1`

### 3. 移動邏輯

#### 位置檢查
```typescript
// 檢查目標位置是否可以放置炸彈
if (this.canMoveBombTo(targetX, targetY, map)) {
  // 移動炸彈到目標位置
} else {
  // 無法移動到目標位置
}
```

#### 地圖更新
```typescript
// 恢復原位置的地圖格子類型
map[bomb.gridY][bomb.gridX].type = 0; // EMPTY

// 移動炸彈到目標位置
bomb.gridX = targetX;
bomb.gridY = targetY;
bomb.pixelX = targetX * TILE_SIZE + TILE_SIZE / 2;
bomb.pixelY = targetY * TILE_SIZE + TILE_SIZE / 2;

// 更新新位置的地圖格子類型
map[targetY][targetX].type = 3; // BOMB
```

## 技術實現詳情

### 1. 位置計算

#### 目標位置確定
- **基準位置**：玩家當前位置
- **方向偏移**：根據玩家面對的方向計算偏移
- **目標位置**：基準位置 + 方向偏移

#### 方向偏移表
| 方向 | X偏移 | Y偏移 | 目標位置 |
|------|-------|-------|----------|
| UP   | 0     | -1    | (x, y-1) |
| DOWN | 0     | +1    | (x, y+1) |
| LEFT | -1    | 0     | (x-1, y) |
| RIGHT| +1    | 0     | (x+1, y) |

### 2. 移動執行

#### 條件檢查
- **邊界檢查**：目標位置不能超出地圖邊界
- **障礙檢查**：目標位置必須是空地
- **可用性檢查**：目標位置沒有其他炸彈

#### 狀態更新
- **網格位置**：更新 `bomb.gridX` 和 `bomb.gridY`
- **像素位置**：更新 `bomb.pixelX` 和 `bomb.pixelY`
- **地圖狀態**：更新地圖格子的類型

### 3. 調試信息

#### 成功移動
```
炸彈移動到玩家面前前進1格位置: (6, 3)
```

#### 移動失敗
```
玩家面前前進1格位置 (6, 3) 無法放置炸彈
```

## 功能特性

### 1. 精確定位

#### 位置計算
- ✅ **準確計算**：根據玩家方向準確計算目標位置
- ✅ **方向性**：炸彈朝著玩家面對的方向移動
- ✅ **距離控制**：移動距離固定為1格

#### 移動執行
- ✅ **即時移動**：踢動後立即移動到目標位置
- ✅ **條件檢查**：檢查目標位置是否可以放置炸彈
- ✅ **狀態同步**：同步更新所有相關狀態

### 2. 地圖管理

#### 地圖更新
- ✅ **原位置清理**：恢復原位置為空地
- ✅ **新位置設置**：設置新位置為炸彈
- ✅ **狀態同步**：確保地圖狀態與炸彈位置一致

#### 碰撞檢測
- ✅ **邊界檢查**：確保不超出地圖邊界
- ✅ **障礙檢查**：確保目標位置是空地
- ✅ **衝突檢查**：確保沒有其他炸彈

### 3. 用戶體驗

#### 操作反饋
- ✅ **即時響應**：踢動後立即看到炸彈移動
- ✅ **視覺效果**：炸彈立即出現在新位置
- ✅ **調試信息**：清楚顯示移動結果

#### 策略性
- ✅ **精確控制**：玩家可以精確控制炸彈位置
- ✅ **戰術應用**：可以將炸彈踢到特定位置
- ✅ **遊戲平衡**：增加遊戲的策略性

## 使用方式

### 1. 基本操作

#### 踢炸彈步驟
1. **獲得道具**：收集踢炸彈道具（👟）
2. **面對炸彈**：讓玩家面對想要踢動的炸彈
3. **按鍵踢動**：按 B 鍵（玩家1）或右 Shift 鍵（玩家2）
4. **觀察效果**：炸彈立即移動到玩家面前前進1格

#### 位置計算
- **玩家位置**：假設玩家在 (5, 3)
- **面對方向**：假設玩家面對右方
- **目標位置**：炸彈移動到 (6, 3)

### 2. 方向示例

#### 向上踢動
- **玩家位置**：(5, 3)
- **面對方向**：UP
- **目標位置**：(5, 2)

#### 向下踢動
- **玩家位置**：(5, 3)
- **面對方向**：DOWN
- **目標位置**：(5, 4)

#### 向左踢動
- **玩家位置**：(5, 3)
- **面對方向**：LEFT
- **目標位置**：(4, 3)

#### 向右踢動
- **玩家位置**：(5, 3)
- **面對方向**：RIGHT
- **目標位置**：(6, 3)

### 3. 注意事項

#### 移動限制
- **邊界限制**：不能移動到地圖邊界外
- **障礙限制**：不能移動到牆壁或其他障礙物
- **衝突限制**：不能移動到其他炸彈位置

#### 最佳實踐
- **位置選擇**：選擇合適的位置來踢動炸彈
- **方向控制**：確保玩家面對正確的方向
- **時機把握**：在合適的時機踢動炸彈

## 調試信息

### 1. 成功移動
```
玩家 1 面前有炸彈，位置: (5, 3)，方向: 3
玩家 1 踢動炸彈，方向: 3，炸彈位置: (5, 3)
炸彈移動到玩家面前前進1格位置: (6, 3)
```

### 2. 移動失敗
```
玩家 1 面前有炸彈，位置: (5, 3)，方向: 3
玩家 1 踢動炸彈，方向: 3，炸彈位置: (5, 3)
玩家面前前進1格位置 (6, 3) 無法放置炸彈
```

### 3. 位置追蹤
```
炸彈踢動：從 (5, 3) 到 (6, 3)，距離: 1/2
炸彈踢動成功，距離: 1/2
```

## 技術改進

### 1. 位置計算
- **精確計算**：準確計算目標位置
- **方向性**：確保炸彈朝著正確方向移動
- **距離控制**：固定移動距離為1格

### 2. 移動執行
- **即時移動**：踢動後立即移動
- **條件檢查**：確保移動的可行性
- **狀態同步**：保持所有狀態一致

### 3. 用戶體驗
- **操作直觀**：炸彈移動到預期位置
- **反饋清晰**：清楚的調試信息
- **策略深度**：增加遊戲的策略性

## 結論

通過修改 `moveBombToPlayerFront` 方法，成功實現了：

1. **精確定位**：炸彈移動到玩家面前前進1格的位置
2. **即時移動**：踢動後立即移動到目標位置
3. **條件檢查**：確保移動的可行性和安全性
4. **狀態同步**：保持所有相關狀態的一致性

現在炸彈被踢動後會立即移動到玩家面前前進1格的位置，大大提升了踢炸彈功能的精確性和可預測性！💣👟🎯
