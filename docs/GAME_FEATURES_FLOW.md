# 🎮 炸彈人遊戲功能流程圖

## 📋 目錄
1. [遊戲功能總覽](#1-遊戲功能總覽)
2. [核心遊戲機制](#2-核心遊戲機制)
3. [道具系統流程](#3-道具系統流程)
4. [特殊功能流程](#4-特殊功能流程)
5. [UI 交互流程](#5-ui-交互流程)
6. [音效系統流程](#6-音效系統流程)

---

## 1. 遊戲功能總覽

```mermaid
mindmap
  root((炸彈人遊戲))
    核心玩法
      玩家移動
        方向控制
        碰撞檢測
        速度調節
      炸彈系統
        放置炸彈
        爆炸範圍
        連鎖爆炸
        踢炸彈
      地圖系統
        隨機生成
        硬牆軟牆
        道具生成
    道具系統
      火力道具
        增加威力
        穿透效果
      炸彈道具
        增加數量
        冷卻時間
      速度道具
        移動加速
        流暢體驗
      踢炸彈道具
        踢動能力
        距離增加
      穿透道具
        穿透軟牆
        碰撞引爆
      遙控道具
        遙控引爆
        戰術優勢
      防護罩道具
        無敵狀態
        時效限制
    UI 系統
      主菜單
        開始遊戲
        設置選項
      遊戲界面
        HUD 顯示
        玩家信息
        分數統計
      暫停菜單
        繼續遊戲
        重新開始
        返回主菜單
      遊戲結束
        獲勝顯示
        再玩一次
        統計信息
    音效系統
      背景音樂
        主菜單音樂
        遊戲音樂
      音效
        炸彈爆炸
        道具收集
        玩家死亡
        按鍵音效
```

---

## 2. 核心遊戲機制

### 🎯 玩家移動機制

```mermaid
flowchart TD
    A[玩家按下移動鍵] --> B{檢查移動能力}
    B -->|有移動能力| C[計算目標位置]
    B -->|無移動能力| D[忽略輸入]
    C --> E{檢查碰撞}
    E -->|可移動| F[更新玩家位置]
    E -->|被阻擋| G[更新面向方向]
    F --> H[更新像素位置]
    G --> H
    H --> I[觸發渲染更新]
    I --> J[播放移動音效]
    
    subgraph "移動限制"
        K[地圖邊界]
        L[硬牆阻擋]
        M[軟牆阻擋]
        N[炸彈阻擋]
    end
    
    E --> K
    E --> L
    E --> M
    E --> N
```

### 💣 炸彈系統機制

```mermaid
flowchart TD
    A[玩家按下炸彈鍵] --> B{檢查放置條件}
    B -->|數量未達上限| C{檢查冷卻時間}
    B -->|數量已達上限| D[顯示提示信息]
    C -->|冷卻完成| E{檢查位置空閒}
    C -->|冷卻中| F[忽略輸入]
    E -->|位置空閒| G[創建炸彈對象]
    E -->|位置被佔用| H[無法放置]
    G --> I[更新地圖格子]
    I --> J[增加玩家炸彈計數]
    J --> K[設置冷卻時間]
    K --> L[播放放置音效]
    
    subgraph "炸彈屬性"
        M[爆炸威力]
        N[爆炸範圍]
        O[穿透能力]
        P[遙控能力]
    end
    
    G --> M
    G --> N
    G --> O
    G --> P
```

### 🔥 爆炸機制

```mermaid
flowchart TD
    A[炸彈計時器到期] --> B[標記炸彈為已爆炸]
    B --> C[恢復地圖格子]
    C --> D[減少玩家炸彈計數]
    D --> E[計算爆炸範圍]
    E --> F[獲取爆炸位置]
    F --> G{檢查每個位置}
    G -->|硬牆| H[停止該方向爆炸]
    G -->|軟牆| I{檢查穿透能力}
    G -->|空地| J[添加到爆炸位置]
    I -->|有穿透| K[摧毀軟牆並繼續]
    I -->|無穿透| L[摧毀軟牆並停止]
    K --> M[生成道具]
    L --> M
    M --> N[檢查連鎖爆炸]
    N --> O[播放爆炸音效]
    O --> P[更新遊戲狀態]
```

---

## 3. 道具系統流程

### 🎁 道具生成流程

```mermaid
flowchart TD
    A[軟牆被摧毀] --> B{隨機生成道具}
    B -->|50% 機率| C[選擇道具類型]
    B -->|50% 機率| D[不生成道具]
    C --> E[創建道具對象]
    E --> F[設置道具位置]
    F --> G[更新地圖標記]
    G --> H[添加到道具列表]
    H --> I[播放生成音效]
    
    subgraph "道具類型選擇"
        J[火力道具 - 20%]
        K[炸彈道具 - 20%]
        L[速度道具 - 15%]
        M[踢炸彈道具 - 15%]
        N[穿透道具 - 10%]
        O[遙控道具 - 10%]
        P[防護罩道具 - 10%]
    end
    
    C --> J
    C --> K
    C --> L
    C --> M
    C --> N
    C --> O
    C --> P
```

### 🎯 道具收集流程

```mermaid
flowchart TD
    A[玩家移動到道具位置] --> B{檢查道具存在}
    B -->|道具存在| C[標記道具為已收集]
    B -->|道具不存在| D[忽略碰撞]
    C --> E[根據道具類型應用效果]
    E --> F{道具類型}
    F -->|火力| G[增加炸彈威力]
    F -->|炸彈| H[增加最大炸彈數]
    F -->|速度| I[增加移動速度]
    F -->|踢炸彈| J[啟用踢炸彈能力]
    F -->|穿透| K[啟用穿透能力]
    F -->|遙控| L[啟用遙控能力]
    F -->|防護罩| M[啟用無敵狀態]
    G --> N[更新玩家屬性]
    H --> N
    I --> N
    J --> N
    K --> N
    L --> N
    M --> N
    N --> O[清除地圖標記]
    O --> P[播放收集音效]
    P --> Q[更新 UI 顯示]
```

---

## 4. 特殊功能流程

### 👟 踢炸彈功能

```mermaid
flowchart TD
    A[玩家按下踢炸彈鍵] --> B{檢查踢炸彈能力}
    B -->|有踢炸彈能力| C[尋找附近炸彈]
    B -->|無踢炸彈能力| D[顯示提示信息]
    C --> E{找到可踢動炸彈}
    E -->|找到炸彈| F[設置炸彈踢動狀態]
    E -->|未找到炸彈| G[踢炸彈失敗]
    F --> H[移動炸彈到玩家面前]
    H --> I[設置踢動方向]
    I --> J[開始炸彈移動]
    J --> K{檢查移動距離}
    K -->|未達最大距離| L[繼續移動]
    K -->|達到最大距離| M[停止踢動]
    L --> N{檢查碰撞}
    N -->|遇到玩家| O[立即引爆]
    N -->|遇到障礙| P[停止踢動]
    N -->|空地| Q[繼續移動]
    M --> R[播放踢動音效]
    O --> R
    P --> R
    Q --> K
```

### 💥 穿透爆炸功能

```mermaid
flowchart TD
    A[炸彈爆炸] --> B{檢查穿透能力}
    B -->|有穿透能力| C[計算穿透爆炸範圍]
    B -->|無穿透能力| D[計算普通爆炸範圍]
    C --> E[遍歷爆炸位置]
    D --> E
    E --> F{檢查位置類型}
    F -->|硬牆| G[停止爆炸]
    F -->|軟牆| H{檢查穿透能力}
    F -->|空地| I[添加到爆炸位置]
    H -->|有穿透| J[摧毀軟牆並繼續]
    H -->|無穿透| K[摧毀軟牆並停止]
    J --> L[生成道具]
    K --> L
    I --> M[檢查連鎖爆炸]
    L --> M
    M --> N[播放爆炸音效]
```

---

## 5. UI 交互流程

### 🎮 主菜單交互

```mermaid
flowchart TD
    A[遊戲啟動] --> B[顯示主菜單]
    B --> C{用戶操作}
    C -->|點擊開始遊戲| D[初始化遊戲]
    C -->|點擊設置| E[顯示設置菜單]
    C -->|按 ESC| F[退出遊戲]
    D --> G[生成地圖]
    G --> H[創建玩家]
    H --> I[開始遊戲循環]
    I --> J[顯示遊戲界面]
    E --> K[調整遊戲設置]
    K --> B
    F --> L[關閉應用]
```

### ⏸️ 暫停菜單交互

```mermaid
flowchart TD
    A[遊戲進行中] --> B{用戶操作}
    B -->|按 ESC| C[暫停遊戲]
    B -->|其他操作| D[繼續遊戲]
    C --> E[顯示暫停菜單]
    E --> F{菜單選項}
    F -->|繼續遊戲| G[恢復遊戲]
    F -->|重新開始| H[重置遊戲]
    F -->|主菜單| I[返回主菜單]
    G --> D
    H --> J[重新初始化]
    I --> K[顯示主菜單]
    J --> L[開始新遊戲]
    L --> D
```

### 🏆 遊戲結束交互

```mermaid
flowchart TD
    A[玩家死亡] --> B[檢查獲勝者]
    B --> C[設置遊戲狀態為結束]
    C --> D[顯示遊戲結束畫面]
    D --> E{用戶操作}
    E -->|再玩一次| F[重新開始遊戲]
    E -->|主菜單| G[返回主菜單]
    E -->|查看統計| H[顯示統計信息]
    F --> I[重置所有狀態]
    I --> J[生成新地圖]
    J --> K[創建新玩家]
    K --> L[開始新遊戲]
    G --> M[顯示主菜單]
    H --> N[顯示詳細統計]
    N --> E
```

---

## 6. 音效系統流程

### 🎵 音效播放流程

```mermaid
flowchart TD
    A[遊戲事件發生] --> B{事件類型}
    B -->|炸彈放置| C[播放放置音效]
    B -->|炸彈爆炸| D[播放爆炸音效]
    B -->|道具收集| E[播放收集音效]
    B -->|玩家死亡| F[播放死亡音效]
    B -->|按鍵操作| G[播放按鍵音效]
    B -->|遊戲結束| H[播放結束音效]
    C --> I[檢查音頻上下文]
    D --> I
    E --> I
    F --> I
    G --> I
    H --> I
    I --> J{音頻已初始化}
    J -->|已初始化| K[播放音效]
    J -->|未初始化| L[跳過播放]
    K --> M[設置音量]
    M --> N[播放音頻]
    L --> O[繼續遊戲邏輯]
    N --> O
```

### 🎶 背景音樂流程

```mermaid
flowchart TD
    A[遊戲狀態改變] --> B{新狀態}
    B -->|主菜單| C[播放主菜單音樂]
    B -->|遊戲中| D[播放遊戲音樂]
    B -->|暫停| E[暫停背景音樂]
    B -->|遊戲結束| F[播放結束音樂]
    C --> G[停止當前音樂]
    D --> G
    E --> H[保持當前音樂]
    F --> G
    G --> I[載入新音樂]
    I --> J[設置循環播放]
    J --> K[開始播放]
    H --> L[繼續遊戲邏輯]
    K --> L
```

---

## 🎯 功能特點總結

### ✅ 核心功能
- **流暢的玩家移動** - 支持方向控制和碰撞檢測
- **智能炸彈系統** - 支持放置、爆炸、連鎖反應
- **豐富的道具系統** - 7種不同類型的道具
- **特殊遊戲機制** - 踢炸彈、穿透爆炸等

### 🎨 UI/UX 功能
- **直觀的菜單系統** - 主菜單、暫停菜單、遊戲結束
- **實時 HUD 顯示** - 玩家信息、分數、時間
- **響應式設計** - 適配不同屏幕尺寸

### 🔊 音效功能
- **完整的音效系統** - 遊戲事件音效
- **背景音樂** - 不同場景的音樂
- **音量控制** - 可調節的音量設置

### ⚡ 性能功能
- **60 FPS 流暢運行** - 優化的遊戲循環
- **內存管理** - 對象池和垃圾回收優化
- **性能監控** - Web Vitals 性能指標

---

*此文檔詳細描述了炸彈人遊戲的所有功能流程，可以作為開發、測試和維護的參考指南。*
